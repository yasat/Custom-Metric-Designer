{% extends "base.html" %}
{% block content %}

<style>
.card {
    border-left: 4px solid #0d6efd;
    background-color: #f9f9f9;
}
</style>

<h2>Participant Dashboard</h2>

{% if final_result %}
{{ final_result|safe }}
{% endif %}

{% if pid %}
    <a href="{% url 'reorder_staging_view' pid %}" class="btn btn-sm btn-secondary">Reorder Metrics</a>
    {% if staging_data %}
        {% for staging in staging_data %}
            <hr>
            <h4>Priority: {{ staging.priority }}</h4>
            <h6>Staging ID: {{ staging.id }}</h6>
            <p>
                <strong>Category:</strong> {{ staging.category }} |
                <strong>Perspective:</strong> {{ staging.perspective }} |
                <strong>Metric Type:</strong> {{ staging.metric_type }}
            </p>

            {% if staging.metric_type == "existing" %}
                {% for metric in staging.metrics %}
                    <div class="p-2 border rounded mb-2">
                        {{ metric.preview|safe }}
                        <br>
                        <a href="{{ metric.edit_url }}" class="btn btn-primary">Edit</a>
                    </div>
                {% endfor %}
            {% else %}
                {% if staging.metrics %}
                    <div class="p-3 border rounded bg-light">
                        {% for metric in staging.metrics %}
                            {{ metric.preview|safe }}
                        {% endfor %}
                        <div class="mt-2">
                            <a href="{{ staging.metrics.0.edit_url }}" class="btn btn-primary">Edit Full Design</a>
                        </div>
                    </div>
                {% else %}
                    <p><em>No metrics found.</em></p>
                {% endif %}
            {% endif %}
        {% endfor %}

    {% else %}
        <p>No designs found for this participant.</p>
    {% endif %}
{% endif %}

{% endblock %}
